import{_ as t,r as e,o,a as c,b as n,d as p,F as l,e as s,g as u}from"./app.eed589f1.js";const r={},i=n("h1",{id:"python\u5904\u7406excel\u6570\u636E",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#python\u5904\u7406excel\u6570\u636E","aria-hidden":"true"},"#"),s(" Python\u5904\u7406Excel\u6570\u636E")],-1),k=n("blockquote",null,[n("p",null,"\u8FD9\u4E24\u5929\u665A\u4E0A\u5E2E\u5B66\u7ECF\u6D4E\u7684\u513F\u5B50\u4ECE\u4E24\u4E2Aexcel\u8868\u4E2D\u63D0\u53D6\u4E86\u4E9B\u6570\u636E\u4F9B\u4ED6\u505A\u6570\u636E\u5206\u6790\u3002"),n("p",null,"\u7B2C\u4E00\u6B21\u7528python\u64CD\u4F5Cexcel\u8868\uFF0C\u8BB0\u5F55\u4E00\u4E0B\u3002"),n("p",null,"\u5355\u7EAF\u8BFB\u53D6\u5199\u5165excel\u6570\u636E\u4E0D\u96BE\uFF0C\u5173\u952E\u662F\u5BF9\u6570\u636E\u53C8\u8FDB\u4E00\u6B65\u63D0\u53D6\u4E86\u6709\u6548\u503C\u3002")],-1),b={href:"/scripts/lzs/%E8%B0%83%E7%A0%94%E6%95%B0%E6%8D%AE.xlsx",target:"_blank",rel:"noopener noreferrer"},m=s("\u8C03\u7814\u6570\u636E.xlsx"),d={href:"/scripts/lzs/%E9%A2%84%E6%B5%8B%E4%BF%A1%E6%81%AF1.xlsx",target:"_blank",rel:"noopener noreferrer"},_=s("\u9884\u6D4B\u4FE1\u606F1.xlsx"),f={href:"/scripts/lzs/%E9%A2%84%E6%B5%8B%E4%BF%A1%E6%81%AF2.xlsx",target:"_blank",rel:"noopener noreferrer"},y=s("\u9884\u6D4B\u4FE1\u606F2.xlsx"),g={href:"/scripts/lzs/%E9%A2%84%E6%B5%8B%E4%BF%A1%E6%81%AF3.xlsx",target:"_blank",rel:"noopener noreferrer"},x=s("\u9884\u6D4B\u4FE1\u606F3.xlsx"),h={href:"/scripts/lzs/lzs.py",target:"_blank",rel:"noopener noreferrer"},w=s("lzs.py"),E=u(`<div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token keyword">from</span> logging<span class="token punctuation">.</span>config <span class="token keyword">import</span> valid_ident
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> allow_connection_pickling
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> time
<span class="token keyword">import</span> re
<span class="token keyword">import</span> copy


<span class="token keyword">def</span> <span class="token function">printList</span><span class="token punctuation">(</span>print_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
   count <span class="token operator">=</span> <span class="token number">1</span>   
   <span class="token keyword">for</span> result <span class="token keyword">in</span> print_list<span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;     &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
       count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">def</span> <span class="token function">deleteDuplicate</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">:</span>
   func <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token keyword">if</span> y <span class="token keyword">in</span> x <span class="token keyword">else</span> x <span class="token operator">+</span> <span class="token punctuation">[</span>y<span class="token punctuation">]</span>
   li <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token operator">+</span> li<span class="token punctuation">)</span>
   <span class="token keyword">return</span> li

<span class="token keyword">def</span> <span class="token function">export_excel</span><span class="token punctuation">(</span>export<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8F93\u51FA\u7ED3\u679C\u5230\u300A%s\u300B...&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token comment">#\u5C06\u5B57\u5178\u5217\u8868\u8F6C\u6362\u4E3ADataFrame</span>
   pf <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>export<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token comment">#\u6307\u5B9A\u5B57\u6BB5\u987A\u5E8F</span>
   order <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;Stkcd&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Ananm&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;InstitutionID&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Brokern&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;YEAR&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">]</span>
   pf <span class="token operator">=</span> pf<span class="token punctuation">[</span>order<span class="token punctuation">]</span>
   <span class="token comment">#\u5C06\u5217\u540D\u66FF\u6362\u4E3A\u4E2D\u6587</span>
   columns_map <span class="token operator">=</span> <span class="token punctuation">{</span>
       <span class="token string">&#39;Stkcd&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;Stkcd&#39;</span><span class="token punctuation">,</span>
       <span class="token string">&#39;Ananm&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;Ananm&#39;</span><span class="token punctuation">,</span>
       <span class="token string">&#39;InstitutionID&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;InstitutionID&#39;</span><span class="token punctuation">,</span>
       <span class="token string">&#39;Brokern&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;Brokern&#39;</span><span class="token punctuation">,</span>
       <span class="token string">&#39;YEAR&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;YEAR&#39;</span><span class="token punctuation">,</span>
       <span class="token string">&#39;count&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;count&#39;</span>
   <span class="token punctuation">}</span>
   pf<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns <span class="token operator">=</span> columns_map<span class="token punctuation">,</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
   <span class="token comment">#\u6307\u5B9A\u751F\u6210\u7684Excel\u8868\u683C\u540D\u79F0</span>
   file_path <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
   <span class="token comment">#\u66FF\u6362\u7A7A\u5355\u5143\u683C</span>
   pf<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">,</span>inplace <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
   <span class="token comment">#\u8F93\u51FA</span>
   pf<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">,</span>index <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
   <span class="token comment">#\u4FDD\u5B58\u8868\u683C</span>
   file_path<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8F93\u51FA\u7ED3\u679C\u6210\u529F&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u53D6\u300A\u8C03\u7814\u6570\u636E.xlsx\u300B...&quot;</span><span class="token punctuation">)</span>
   all_start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
   df0 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">&#39;\u8C03\u7814\u6570\u636E.xlsx&#39;</span><span class="token punctuation">)</span>
   <span class="token comment"># print(df0)</span>
   all_list <span class="token operator">=</span> df0<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">&#39;records&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">]</span>
   result_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>all_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token builtin">all</span> <span class="token operator">=</span> all_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
       researcher_list <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">[</span><span class="token string">&#39;Researcher&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;;&#39;</span><span class="token punctuation">)</span>
       <span class="token keyword">for</span> researcher <span class="token keyword">in</span> researcher_list<span class="token punctuation">:</span>
           semicolon_index <span class="token operator">=</span> researcher<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">&#39;:&#39;</span><span class="token punctuation">)</span>
           <span class="token keyword">if</span> semicolon_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
               researcher <span class="token operator">=</span> researcher<span class="token punctuation">[</span>semicolon_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
               researchers <span class="token operator">=</span> researcher<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;\u3001&quot;</span><span class="token punctuation">)</span>
               
               <span class="token keyword">for</span> research <span class="token keyword">in</span> researchers<span class="token punctuation">:</span>
                   all_copy <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                   all_copy<span class="token punctuation">[</span><span class="token string">&#39;Researcher&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> research<span class="token punctuation">;</span>
                   result_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>all_copy<span class="token punctuation">)</span>
                   <span class="token comment"># print(len(result_list), research, result_list[len(result_list)-1])</span>
           <span class="token keyword">else</span> <span class="token punctuation">:</span>
               all_copy <span class="token operator">=</span> <span class="token builtin">all</span><span class="token punctuation">;</span>
               all_copy<span class="token punctuation">[</span><span class="token string">&#39;Researcher&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> researcher<span class="token punctuation">;</span>
               result_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>all_copy<span class="token punctuation">)</span>
               <span class="token comment"># print(len(result_list), researcher, result_list[len(result_list)-1])</span>
   <span class="token comment"># printList(result_list)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u53D6\u300A\u8C03\u7814\u6570\u636E\u521D\u59CB\u5316\u300B\u5171[%d]\u6761\u6570\u636E&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

   file_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   file_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&#39;\u9884\u6D4B\u4FE1\u606F1.xlsx&#39;</span><span class="token punctuation">)</span>
   file_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&#39;\u9884\u6D4B\u4FE1\u606F2.xlsx&#39;</span><span class="token punctuation">)</span>
   file_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&#39;\u9884\u6D4B\u4FE1\u606F3.xlsx&#39;</span><span class="token punctuation">)</span>
   <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
       start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u53D6\u300A%s\u300B...&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       df0 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
       <span class="token comment"># print(df1)</span>
       data_list <span class="token operator">=</span> df0<span class="token punctuation">.</span>to_dict<span class="token punctuation">(</span>orient<span class="token operator">=</span><span class="token string">&#39;records&#39;</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BFB\u53D6\u300A%s\u300B\u5171[%d]\u6761\u6570\u636E\uFF0C\u5F00\u59CB\u7EDF\u8BA1...&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

       count <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token keyword">for</span> data <span class="token keyword">in</span> data_list<span class="token punctuation">:</span>
           data<span class="token punctuation">[</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
           <span class="token comment"># print(count / len(data_list))</span>
           count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
           <span class="token keyword">for</span> result <span class="token keyword">in</span> result_list<span class="token punctuation">:</span>
               <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">&#39;Researcher&#39;</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Ananm&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                   data<span class="token punctuation">[</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
       export_excel<span class="token punctuation">(</span>data_list<span class="token punctuation">,</span> <span class="token string">&quot;result_%s&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

       valid_count <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token keyword">for</span> data <span class="token keyword">in</span> data_list<span class="token punctuation">:</span>
           <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
               valid_count <span class="token operator">=</span> valid_count <span class="token operator">+</span> <span class="token number">1</span>
               <span class="token comment"># if (valid_count &lt; 100) :</span>
               <span class="token comment">#     print(data)</span>
                   <span class="token comment"># print (data[&#39;Stkcd&#39;], data[&#39;Ananm&#39;], data[&#39;Brokern&#39;], data[&#39;InstitutionID&#39;], data[&#39;YEAR&#39;], data[&#39;count&#39;])</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string">&quot;\u6709\u6548\u6570\u636E(count &gt; 0)[%d]\u6761\uFF0C\u8017\u65F6[%.3fs]&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>valid_count<span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\u603B\u8017\u65F6[%d]s&quot;</span><span class="token operator">%</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> all_start<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div>`,1);function q(A,B){const a=e("ExternalLinkIcon");return o(),c(l,null,[i,k,n("p",null,[n("a",b,[m,p(a)])]),n("p",null,[n("a",d,[_,p(a)])]),n("p",null,[n("a",f,[y,p(a)])]),n("p",null,[n("a",g,[x,p(a)])]),n("p",null,[n("a",h,[w,p(a)])]),E],64)}var F=t(r,[["render",q]]);export{F as default};
